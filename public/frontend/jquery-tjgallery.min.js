/*!
 * tjGallery 0.9
 * http://tj-s.ru
 * @copyright	Tod, tod@tj-s.ru
 * @license		MIT License
 */
!function(t){var i={init:function(e){var n=t.extend({selector:"img",row_min_height:180,margin:5},e);return this.each(function(){function e(){i.clear.apply(r),a(r)}function a(i){return i.each(function(){var i=t(this),e=i.width(),a=[],r={items:[],width:0,height:0};i.find(n.selector).each(function(){var i=t(this),s=i;if("IMG"!=s[0].nodeName.toUpperCase()?(s=s.find("img"),i=t('<div class="tjGalleryItem">').insertBefore(i).append(i)):i=t('<div class="tjGalleryItem">').insertBefore(s).append(s),s.length){i.css({width:"auto",float:"left",position:"relative"});var o={pic:s,container:i,original_height:s.attr("height")||s.height(),original_width:s.attr("width")||s.width()};o.aspect=o.original_width/o.original_height,o.scale=n.row_min_height/o.original_height,o.width=o.original_width*o.scale,o.height=o.original_height*o.scale,h(r.items,o)>e&&(a.push(r),r={items:[],width:0,height:0}),r.items.push(o)}}),a.push(r),r.last=!0,t.each(a,function(i,a){a.last||(a.scale=(e-(a.items.length-1)*n.margin)/h(a.items));var r,s=0;if(t.each(a.items,function(t,i){a.scale&&(i.width=Math.round(i.width*a.scale),i.height=Math.round(i.height*a.scale)),i.index=s;var e=i.pic;i.container;r=i,s++,e.css({height:parseInt(i.height)+"px",width:parseInt(i.width)+"px"}),i.container.css({height:parseInt(i.height)+"px",width:parseInt(i.width)+"px",marginTop:n.margin+"px"}),t>0?i.container.css({marginLeft:n.margin+"px"}):i.container.css({clear:"left"})}),r){var o=r.width;r.width=r.width+e-h(a.items),(r.width-o<40&&a.last||!a.last)&&(r.pic.css({width:r.width+"px"}),r.container.css({width:r.width+"px"}))}})})}function h(i,e){var a=0;return i.length&&(a=n.margin*(i.length-1),t.each(i,function(t,i){a+=i.width})),e&&(a+=e.width),a}var r=t(this);return r.data("tjGallery")||r.data("tjGallery",{target:r,tjGallery:n}),t(window).bind("resize.tjGallery",e),a(r)})},clear:function(){conteiner=this,data=conteiner.data("tjGallery"),conteiner.each(function(){t(this).find(data.tjGallery.selector).each(function(){t(this).is("img")||t(this).find("img").css({width:"auto",height:"auto"}),t(this).removeAttr("style"),t(this).appendTo(conteiner)}),t(this).find("div:empty").remove()})},destroy:function(){i.clear.apply(this),t(window).unbind(".tjGallery")}};t.fn.tjGallery=function(e){if(i[e])return i[e].apply(this,Array.prototype.slice.call(arguments,1));if("object"==typeof e||!e){return i.init.apply(this,arguments)}t.error("Method "+e+" does not exist for jQuery.tjGallery")}}(jQuery);